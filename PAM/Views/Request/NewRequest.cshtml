@using PAM.Models
@using PAM.Extensions

@model PAM.Models.Request

@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@{
    var requester = HttpContextAccessor.HttpContext.Session.GetObject<Requester>("Requester");
    ViewData["Title"] = "New Request";
}

<body>
    <partial name="_ProgressBar.cshtml" />
    <div class="step text-center">
        <h1> Is this request for yourself? </br> or for another individual? </h1>
    </div>

    <form asp-controller="RequesterInfo" asp-action="RequestSelf" method="post">
        <div class="text-center">
            <input asp-for="Name" value="@requester.Name" type="hidden" />
            <input asp-for="Username" value="@requester.Username" type="hidden" />
            <input asp-for="RequestedById" value=@requester.RequesterId type="hidden" />
            <input asp-for="RequestedForId" value="@requester.RequesterId" type="hidden" />
            <button type="submit" class="btn btn-info" onclick="progressBar(20)" style="display:inline-block">Self</button>
        </div>
    </form>
    </br>
    <form asp-controller="RequesterInfo" asp-action="RequestOther" method="post">
        <div class="text-center">
            <input asp-for="Name" value="@requester.Name" type="hidden" />
            <input asp-for="Username" value="@requester.Username" type="hidden" />
            <input asp-for="RequestedById" value=@requester.RequesterId type="hidden" />
            <!--TODO: Fix to Proper RequestedForId-->
            <input asp-for="RequestedForId" value="@requester.RequesterId" type="hidden" />
            <button type="submit" class="btn btn-info" onclick="progressBar(20)" style="display:inline-block">Another</button>
        </div>
    </form>
    <!--
          <div class="step">
          </div>
          <div class="step">
              <div class="jumbotron" style="text-align:center">
                  <h1>Thank you for submitting your request.</h1> <br\>
                      <h1> Your requests will be processed by the department.</h1>
              </div>
          </div>
          <button type="button" class="btn btn-info float-left m-3" id="draft"> Save Draft </button>
          <button type="button" class="btn btn-info float-right m-3" id="next" onclick="nextPrev(1)" style="margin-left: 6px;"> Next </button>
          <button type="button" class="btn btn-info float-right m-3" id="prev" onclick="nextPrev(-1)" style="margin-left: 6px;"> Previous </button>

          <div class="text-center">
              <a type="button" class="btn btn-info" id="view" style="display: none" href=""> Preview </a>
              <a type="button" class="btn btn-info" id="submitAgain" style="display: none" href="/Home/NewRegistrations"> Submit Another </a>
          </div>
    -->
    <script>
        /*----------------------------------------------------------
            [ Script for proceeding to next step ]
        */
        var currentStep = 0;
        showStep(currentStep);
        function showStep(n) {
            var x = document.getElementsByClassName("step");
            // This function will display the specified tab of the form...
            x[n].style.display = "block";
            //Show previous button only after next has been clicked
            if (n == 0) {
                document.getElementById("draft").style.display = "none";
                document.getElementById("next").style.display = "none";
                document.getElementById("prev").style.display = "none";
            } else {
                document.getElementById("draft").style.display = "inline";
                document.getElementById("next").style.display = "inline";
                document.getElementById("prev").style.display = "inline";
            }
            //Display the submit button for submission and hide the next button on 2nd to last step
            if (n == (x.length - 2)) {
                document.getElementById("next").innerHTML = "Submit";
            } else {
                document.getElementById("next").innerHTML = "Next";
            }
            //Hide all buttons except preview and another submission
            if (n == (x.length - 1)) {
                document.getElementById("draft").style.display = "none";
                document.getElementById("next").style.display = "none";
                document.getElementById("prev").style.display = "none";
                document.getElementById("view").style.display = "inline-block";
                document.getElementById("submitAgain").style.display = "inline-block";
            }
            progressBar(currentStep);
        }
        function nextPrev(n) {
            var x = document.getElementsByClassName("step");
            if (n == 1 && !validateForm()) return false;
            // Hide the current tab:
            x[currentStep].style.display = "none";
            // Increase or decrease the current tab by 1:
            currentStep = currentStep + n;
            if (currentStep >= x.length - 1) {
                document.getElementById("reqForm").submit();
            }
            showStep(currentStep);
        }
        function validateForm() {
            // This function deals with validation of the form fields
            var x, y, i, valid = true;
            x = document.getElementsByClassName("step");
            y = x[currentStep].getElementsByTagName("input")
            // A loop that checks every input field in the current tab:
            for (i = 0; i < y.length; i++) {
                // If a field is empty...
                if (y[i].id == "validate") {
                    if (y[i].value == "") {
                        // add an "invalid" class to the field:
                        y[i].className += " invalid";
                        // and set the current valid status to false:
                        valid = false;
                    }
                }
            }
            return valid;
        }
    </script>
</body>
