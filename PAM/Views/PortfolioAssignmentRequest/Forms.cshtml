@model Request
@{
  var requiredForms = (List<Form>)ViewData["requiredForms"];
  ViewData["Title"] = "Forms";
  ViewData["id"] = @Model.RequestId;
}
@section StyleSheets{
  <link rel="stylesheet" href="~/css/progressbar.css" />
}
@section Scripts {
  <script>
  $(function(){
    $('#removeBtn').hide();
    var page ='@ViewData["Title"]';
    $("li[data-title='" + page + "']").addClass("active");
    $("#saveDraft").click(function () {
      var form = $(this).parents("form:first");
      form.append("<input type='hidden' name='saveDraft' value='true'>");
      form.submit();
    });
    $(document).ready(function () {
      $('#uploadFile').change(function (f) {
        var fileName = f.target.files[0].name;
        $('#uploadBtn').hide();
        $("<a href=\"ViewForm\" id=\"uploadName\" target=\"_blank\">" + fileName + "</a>").insertAfter("#uploadBtn");
        $('#removeBtn').show();
      });
      $('#removeBtn').click(function () {
        var msg = "Are you sure you want to remove this file?";
        if (confirm(msg)) {
          $('#uploadFile').val('');
          $('#uploadBtn').show();
          $('#uploadName').hide();
          $('#removeBtn').hide();
        }
      });
    });
    });
  </script>
}

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a asp-controller="Request" asp-action="MyRequests">My Requests</a></li>
    <li class="breadcrumb-item active" aria-current="page">Request #@ViewData["id"]</li>
  </ol>
</nav>

<partial name="/Views/Shared/ProgressBars/PortfolioAssignment.cshtml" />

<form asp-action="Forms" method="post">
  @if (!requiredForms.Any())
  {
    <p>No additional form required for the systems requested.</p>
  }
  @if (requiredForms.Any())
  {
    <table class="table table-hover">
      <thead>
        <tr>
          <th scope="col">Form</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody>
        @foreach (var form in requiredForms)
        {
          <tr>
            <td>@form.Name</td>
            <td>
              <label class="btn btn-primary float-right m-1">
                <a asp-controller="Forms" asp-action="DownloadForm" asp-route-id="@form.FileId" class="text-white">Download</a>
              </label>
              <label class="btn btn-danger float-right m-1" id="removeBtn">
                Remove
              </label>
              <label class="btn btn-info float-right m-1" id="uploadBtn">
                Upload <input type="file" id="uploadFile" hidden />
              </label>
            </td>
          </tr>
        }
      </tbody>
    </table>
  }
  <div class="form-row">
    <div class="col-4">
      <button id="saveDraft" class="btn btn-secondary">Save Draft</button>
    </div>
    <div class="col-8 text-right">
      <a asp-action="AdditionalInfo" asp-route-id="@ViewData["id"]" class="btn btn-secondary">Previous</a>
      <button id="next" type="submit" class="btn btn-primary ml-3">Next</button>
    </div>
  </div>
</form>
